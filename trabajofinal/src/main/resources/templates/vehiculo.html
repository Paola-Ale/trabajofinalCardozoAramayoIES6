<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VEHÍCULO</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
</head>

<body class="bg-light">

    <div th:replace="~{layout :: header}"></div>

    <div class="container d-flex justify-content-center align-items-center" style="min-height: 80vh;">
        <div class="card shadow-lg p-4" style="width: 380px; border-radius: 15px;">

            <h1 class="text-center mb-4">VEHÍCULO</h1>

            <form th:object="${nuevoVehiculo}" th:action="${band} ? @{/modificarVehiculo} : @{/guardarVehiculo}"
                method="post" enctype="multipart/form-data">

                <input th:if="${band}" type="hidden" th:field="*{vehiculoId}" />

                <label class="form-label">Patente</label>
                <input class="form-control" type="text" placeholder="Ingresar patente" th:field="*{patente}"
                    minlength="5" maxlength="20" required />
                <span th:if="${#fields.hasErrors('patente')}" th:errors="*{patente}" class="text-danger small"></span>

                <label class="form-label mt-3">Marca</label>
                <select class="form-control" th:field="*{marca}" required>
                    <option value="">Seleccionar marca</option>
                    <option value="Toyota">Toyota</option>
                    <option value="Ford">Ford</option>
                    <option value="Volkswagen">Volkswagen</option>
                    <option value="BMW">BMW</option>
                </select>
                <span th:if="${#fields.hasErrors('marca')}" th:errors="*{marca}" class="text-danger small"></span>

                <label class="form-label mt-3">Color</label>
                <input class="form-control" type="text" th:field="*{color}" placeholder="Ej: Rojo" />
                <span th:if="${#fields.hasErrors('color')}" th:errors="*{color}" class="text-danger small"></span>

                <label class="form-label mt-3">Modelo</label>
                <input class="form-control" type="text" placeholder="Ingresar modelo" th:field="*{modelo}" required />
                <span th:if="${#fields.hasErrors('modelo')}" th:errors="*{modelo}" class="text-danger small"></span>

                <label class="form-label mt-3">Tipo de Vehículo</label>
                <select class="form-control" th:field="*{tipoVehiculo}" required>
                    <option value="">Seleccionar tipo</option>
                    <option value="BASE">BASE</option>
                    <option value="LUXE">LUXE</option>
                    <option value="PREMIUM">PREMIUM</option>
                </select>
                <span th:if="${#fields.hasErrors('tipoVehiculo')}" th:errors="*{tipoVehiculo}"
                    class="text-danger small"></span>


                <div class="mt-3">
                    <label class="form-label d-block">Asignar Conductor</label>

                    <div class="accordion" id="accordionConductor">
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="headingOne">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                                    data-bs-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">
                                    Seleccionar DNI
                                </button>
                            </h2>
                            <div id="collapseOne" class="accordion-collapse collapse" aria-labelledby="headingOne"
                                data-bs-parent="#accordionConductor" style="max-height: 200px; overflow-y: auto;">
                                <div class="accordion-body p-2">

                                    <input type="hidden" id="selectedConductorDni" th:field="*{conductor.dni}" />

                                    <div class="list-group">
                                        <button type="button" class="list-group-item list-group-item-action py-1"
                                            onclick="selectDni('', this)"> [Ninguno / Desasignar]
                                        </button>

                                        <button th:each="c : ${listaConductores}" type="button"
                                            class="list-group-item list-group-item-action py-1"
                                            th:text="${c.dni + ' (' + c.apellido + ')'}"
                                            th:data-dni="${c.dni}"
                                            onclick="selectDni(this.getAttribute('data-dni'), this)"> 
                                        </button>
                                    </div>

                                    <p class="text-success small mt-2">
                                        DNI seleccionado: <strong id="currentDniDisplay" 
                                            th:text="*{conductor} != null and *{conductor.dni} ? *{conductor.dni} : 'N/A'">
                                        </strong>
                                    </p>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <button class="btn btn-dark w-100 mt-4" type="submit"
                    th:text="${band} ? 'Modificar' : 'Ingresar'"></button>
                <div th:if="${errorVehiculo}" class="alert alert-danger mt-3" th:text="${errorVehiculo}"></div>

            </form>

        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        function selectDni(dni, buttonElement) {
            document.getElementById('selectedConductorDni').value = dni;

            let displayElement = document.getElementById('currentDniDisplay');
            
            let buttonText = buttonElement ? buttonElement.textContent.trim() : (dni === '' ? 'N/A' : dni);
            
            displayElement.textContent = buttonText;

            const collapseElement = document.getElementById('collapseOne');
            const bsCollapse = new bootstrap.Collapse(collapseElement, { toggle: false });
            bsCollapse.hide();
        }
    </script>
</body>


</html>
